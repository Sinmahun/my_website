<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .back-btn {
      background-color: #6c757d;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .back-btn:hover {
      background-color: #5a6268;
    }
    
    .record-card {
      border: 1px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      background: #f8f9fa;
    }
    
    .record-image {
      max-width: 250px;
      border-radius: 8px;
      margin-top: 10px;
    }
    
    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    
    .info-message {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <button onclick="goBack()" class="back-btn">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <h1> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠</h1>
    <hr>
    
    <div class="controls">
      <button onclick="loadRecords()" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">
        üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      </button>
      <span id="lastUpdate" style="margin-left: 15px; color: #666;"></span>
    </div>
    
    <div id="loading" style="text-align: center; padding: 20px; display: none;">
      <div style="color: #007bff;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    </div>
    
    <div id="statusMessage"></div>
    
    <div id="recordsContainer" style="margin-top: 30px;"></div>
  </div>

  <script>
    function goBack() {
      window.location.href = "/";
    }
    
    function showMessage(message, type = 'info') {
      const messageDiv = document.getElementById('statusMessage');
      messageDiv.innerHTML = `
        <div class="${type === 'error' ? 'error-message' : 'info-message'}">
          ${type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'} ${message}
        </div>
      `;
    }
    
    function clearMessage() {
      document.getElementById('statusMessage').innerHTML = '';
    }
    
    async function loadRecords() {
      const loading = document.getElementById('loading');
      const container = document.getElementById('recordsContainer');
      
      loading.style.display = 'block';
      container.innerHTML = '';
      clearMessage();
      
      try {
        const response = await fetch('/api/records');
        const data = await response.json();
        
        document.getElementById('lastUpdate').textContent = '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date().toLocaleString('th-TH');
        
        if (!data.success) {
          showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${data.message}`, 'error');
          container.innerHTML = `
            <div style="text-align: center; padding: 30px;">
              <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>
              <button onclick="testDatabase()" style="background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin: 5px;">
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database
              </button>
            </div>
          `;
          return;
        }
        
        if (data.data && data.data.length > 0) {
          let html = '<div class="stats" style="margin-bottom: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">';
          html += `<strong>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${data.data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;
          
          data.data.forEach(record => {
            html += `
              <div class="record-card">
                <div>
                  <strong>‡∏£‡∏´‡∏±‡∏™:</strong> #${record.id}
                  <strong>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${record.period}
                  <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${new Date(record.created_at).toLocaleString('th-TH')}
                </div>
                <div style="margin-top: 10px;">
                  <strong>‡∏†‡∏≤‡∏û:</strong>
                  <img src="/uploads/${record.image}" alt="‡∏†‡∏≤‡∏û‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠" class="record-image" 
                       onerror="this.style.display='none'; this.parentElement.innerHTML+='<p style=color:red;>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏†‡∏≤‡∏û</p>'">
                </div>
              </div>
            `;
          });
          
          container.innerHTML = html;
        } else {
          showMessage('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'info');
          container.innerHTML = `
            <div style="text-align: center; padding: 50px;">
              <div style="font-size: 48px;">üì≠</div>
              <h3 style="color: #6c757d;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
              <p>‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
            </div>
          `;
        }
      } catch (error) {
        showMessage(`‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
        console.error('Error loading records:', error);
      } finally {
        loading.style.display = 'none';
      }
    }
    
    async function testDatabase() {
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        alert(`‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Database: ${data.database}\n‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${data.message || data.error || 'OK'}`);
      } catch (error) {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
      }
    }
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.addEventListener('DOMContentLoaded', loadRecords);
  </script>
</body>
</html>